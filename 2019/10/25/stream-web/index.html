<!DOCTYPE html>
<html lang="zh-CN">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="webç«¯çš„éŸ³é¢‘æµ">




  <meta name="keywords" content="html5, Sampwoodçš„One Piece">










  <link rel="alternate" href="/atom.xml" title="Sampwoodçš„One Piece">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.1">



<link rel="canonical" href="https://sampwood.github.io/2019/10/25/stream-web/">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1">



  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>








<script>
  window.config = {"title":"Sampwoodçš„One Piece","subtitle":"step by step","description":"Web developer form somewhere","author":"Sampwood","language":"zh-CN","timezone":"Asia/Shanghai","url":"https://sampwood.github.io","root":"/","permalink":":year/:month/:day/:title/","permalink_defaults":null,"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":title.md","default_layout":"post","titlecase":false,"external_link":true,"filename_case":0,"render_drafts":false,"post_asset_folder":false,"relative_link":false,"future":true,"highlight":{"enable":true,"auto_detect":false,"line_number":true,"tab_replace":null,"first_line_number":"always1"},"default_category":"uncategorized","category_map":null,"tag_map":null,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","per_page":0,"pagination_dir":"page","theme":"even","deploy":{"type":"git","repo":"https://github.com/Sampwood/sampwood.github.io.git","branch":"master"},"ignore":[],"index_generator":{"per_page":10,"order_by":"-date","path":""},"jsonContent":{"meta":false,"pages":false,"posts":{"title":true,"date":true,"path":true,"text":false,"raw":false,"content":false,"slug":false,"updated":false,"comments":false,"link":false,"permalink":false,"excerpt":false,"categories":false,"tags":true}},"archive_generator":{"per_page":0,"yearly":true,"monthly":true,"daily":false},"feed":{"type":"atom","limit":20,"hub":"","content":true,"content_limit":140,"content_limit_delim":"","path":"atom.xml"},"category_generator":{"per_page":0},"tag_generator":{"per_page":0},"marked":{"gfm":true,"pedantic":false,"sanitize":false,"tables":true,"breaks":true,"smartLists":true,"smartypants":true},"server":{"port":4000,"log":false,"ip":"0.0.0.0","compress":false,"header":true},"since":2015,"favicon":"/favicon.ico","rss":"default","menu":{"Home":"/","Archives":"/archives/","Tags":"/tags","Categories":"/categories","About":"/about"},"color":"default","mode":"default","toc":true,"fancybox":true,"pjax":true,"copyright":{"enable":true,"license":"<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc/4.0/\" target=\"_blank\">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>"},"reward":{"enable":false,"qrCode":{"wechat":null,"alipay":null}},"social":{"email":"sampwood@163.com","stack-overflow":null,"twitter":null,"facebook":null,"linkedin":null,"google":null,"github":"https://github.com/sampwood","weibo":null,"zhihu":null,"douban":null,"pocket":null,"tumblr":null,"instagram":null},"leancloud":{"app_id":null,"app_key":null},"baidu_analytics":null,"baidu_verification":null,"google_analytics":null,"google_verification":null,"disqus_shortname":null,"changyan":{"appid":null,"appkey":null},"livere_datauid":null,"version":"2.10.1"};
</script>

    <title> webç«¯çš„éŸ³é¢‘æµ - Sampwoodçš„One Piece </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Sampwoodçš„One Piece</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            é¦–é¡µ
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            å½’æ¡£
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            æ ‡ç­¾
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            åˆ†ç±»
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            å…³äº
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Sampwoodçš„One Piece</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              é¦–é¡µ
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              å½’æ¡£
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              æ ‡ç­¾
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              åˆ†ç±»
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              å…³äº
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          webç«¯çš„éŸ³é¢‘æµ
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-10-25
        </span>
        
          <span class="post-category">
            
              <a href="/categories/coding/">coding</a>
            
              <a href="/categories/coding/html/">html</a>
            
          </span>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#è·å–è®¾å¤‡çš„æ‘„åƒå¤´å’Œéº¦å…‹é£åŠŸèƒ½"><span class="toc-text">è·å–è®¾å¤‡çš„æ‘„åƒå¤´å’Œéº¦å…‹é£åŠŸèƒ½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¦‚ä½•åœæ­¢å½•éŸ³"><span class="toc-text">å¦‚ä½•åœæ­¢å½•éŸ³</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#éŸ³é¢‘æµçš„ä¿å­˜"><span class="toc-text">éŸ³é¢‘æµçš„ä¿å­˜</span></a></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#å‚è€ƒ"><span class="toc-text">å‚è€ƒ</span></a>
    </li></div>
  </div>



    <div class="post-content">
      
        <p>æ˜¨å¤©çœ‹åˆ°ä¸€ä¸ªæœ‰æ„æ€çš„é¢˜ç›®ï¼šæ€ä¹ˆä½¿ç”¨HTML5å®ç°å½•éŸ³çš„åŠŸèƒ½ï¼Ÿ</p>
<p>ç„¶åè¯•ç€äº†è§£äº†ä¸‹ï¼Œå®ç°åŸç†ä¸»è¦æ˜¯ç”¨äº†<code>MediaStream</code>è¿™ä¸ªå¯¹è±¡ã€‚</p>
<blockquote>
<p>The MediaStream interface represents a stream of media content. A stream consists of several tracks such as video or audio tracks.<br>Each track is specified as an instance of MediaStreamTrack.<br>You can obtain a MediaStream object either by using the constructor or by calling MediaDevices.getUserMedia().</p>
</blockquote>
<p>è¿™æ˜¯æ¥è‡ª<code>MDNæ–‡æ¡£</code> å¯¹ <code>MediaStream</code> çš„è¯´æ˜ã€‚</p>
<p>ä»ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¯ä»¥é€šè¿‡ <code>MediaDevices.getUserMedia()</code> æ–¹æ³•æ¥è·å–è®¾å¤‡çš„éŸ³é¢‘è¾“å…¥åŠŸèƒ½ã€‚</p>
<a id="more"></a>
<h3 id="è·å–è®¾å¤‡çš„æ‘„åƒå¤´å’Œéº¦å…‹é£åŠŸèƒ½"><a href="#è·å–è®¾å¤‡çš„æ‘„åƒå¤´å’Œéº¦å…‹é£åŠŸèƒ½" class="headerlink" title="è·å–è®¾å¤‡çš„æ‘„åƒå¤´å’Œéº¦å…‹é£åŠŸèƒ½"></a>è·å–è®¾å¤‡çš„æ‘„åƒå¤´å’Œéº¦å…‹é£åŠŸèƒ½</h3><blockquote>
<p>The MediaDevices.getUserMedia() method prompts the user for permission to use a media input<br>which produces a MediaStream with tracks containing the requested types of media.<br>That stream can include, for example,<br>a video track (produced by either a hardware or virtual video source such as a camera, video recording device, screen sharing service, and so forth),<br>an audio track (similarly, produced by a physical or virtual audio source like a microphone, A/D converter, or the like), and possibly other track types.</p>
</blockquote>
<p>è¿™æ˜¯æ¥è‡ª<code>MDNæ–‡æ¡£</code>çš„è¯´æ˜ã€‚</p>
<p><code>MediaDevices.getUserMedia()</code> è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•° <code>constraints</code> , æ¥æŒ‡å®šå¯¹è¯­éŸ³/è§†é¢‘çš„é™åˆ¶ï¼Œä¾‹å¦‚ï¼š <code>{ audio: true, video: true }</code></p>
<p>ç„¶åå‚è€ƒå®ƒæä¾›çš„demoï¼Œå†™äº†ä¸ª å®æ—¶å½•éŸ³å¹¶æ’­æ”¾çš„åŠŸèƒ½ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"padding: 50px;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">controls</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// Older browsers might not implement mediaDevices at all, so we set an empty object first</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (navigator.mediaDevices === <span class="literal">undefined</span>) &#123;</span></span><br><span class="line"><span class="undefined">      navigator.mediaDevices = &#123;&#125;;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// Some browsers partially implement mediaDevices. We can't just assign an object</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// with getUserMedia as it would overwrite existing properties.</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// Here, we will just add the getUserMedia property if it's missing.</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (navigator.mediaDevices.getUserMedia === <span class="literal">undefined</span>) &#123;</span></span><br><span class="line"><span class="javascript">      navigator.mediaDevices.getUserMedia = <span class="function"><span class="keyword">function</span>(<span class="params">constraints</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// First get ahold of the legacy getUserMedia, if present</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// Some browsers just don't implement it - return a rejected promise with an error</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// to keep a consistent interface</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (!getUserMedia) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'getUserMedia is not implemented in this browser'</span>));</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// Otherwise, wrap the call to the old navigator.getUserMedia with a Promise</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          getUserMedia.call(navigator, constraints, resolve, reject);</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    navigator.mediaDevices.getUserMedia(&#123; <span class="attr">audio</span>: <span class="literal">true</span>, <span class="attr">video</span>: <span class="literal">false</span> &#125;)</span></span><br><span class="line"><span class="javascript">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">stream</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> audio = <span class="built_in">document</span>.querySelector(<span class="string">'audio'</span>);</span></span><br><span class="line"><span class="javascript">      <span class="comment">// Older browsers may not have srcObject</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="string">"srcObject"</span> <span class="keyword">in</span> audio) &#123;</span></span><br><span class="line"><span class="undefined">        audio.srcObject = stream;</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// Avoid using this in new browsers, as it is going away.</span></span></span><br><span class="line"><span class="javascript">        audio.src = <span class="built_in">window</span>.URL.createObjectURL(stream);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="javascript">      audio.onloadedmetadata = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">        audio.play();</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="javascript">    .catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(err.name + <span class="string">": "</span> + err.message);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ä»ä¸Šå¯ä»¥çœ‹å‡ºï¼Œåªè¦æŠŠ <code>audio.srcObject</code> è®¾ç½®æˆè·å–åˆ°çš„ <code>stream</code> å°±å¯ä»¥æ’­æ”¾å½•éŸ³äº†ã€‚</p>
<h3 id="å¦‚ä½•åœæ­¢å½•éŸ³"><a href="#å¦‚ä½•åœæ­¢å½•éŸ³" class="headerlink" title="å¦‚ä½•åœæ­¢å½•éŸ³"></a>å¦‚ä½•åœæ­¢å½•éŸ³</h3><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†éŸ³é¢‘æµçš„è¾“å…¥å’Œè¾“å‡ºã€‚ä½†æ˜¯è¿™ä¸ª <code>audio</code> çš„æš‚åœä¼¼ä¹åªæ§åˆ¶äº†éŸ³é¢‘çš„è¾“å‡ºï¼Œé‚£å¦‚ä½•åœæ­¢éŸ³é¢‘çš„è¾“å…¥å‘¢ï¼Ÿ<br><code>MediaStream</code> æœ¬èº«æ²¡æœ‰æä¾› <code>stop/end</code> ä¹‹ç±»çš„æ–¹æ³•ã€‚</p>
<p>ä»<code>MediaStream</code> çš„è¯´æ˜ä¸­ï¼Œå¯ä»¥çœ‹å‡º <code>MediaStream</code> æ˜¯ç”± <code>MediaStreamTrack</code> ç»„æˆçš„ã€‚</p>
<blockquote>
<p>The MediaStreamTrack interface represents a single media track within a stream;<br>typically, these are audio or video tracks, but other track types may exist as well.</p>
</blockquote>
<p><code>MediaStreamTrack</code> æä¾›äº† <code>stop</code> æ–¹æ³•ï¼š</p>
<blockquote>
<p>Stops playing the source associated to the track, both the source and the track are deassociated. The track state is set to ended.</p>
</blockquote>
<blockquote>
<p>Calling stop() tells the user agent that the trackâ€™s sourceâ€”whatever that source may be, including files, network streams, or a local camera or microphoneâ€”is no longer needed by the MediaStreamTrack.  Since multiple tracks may use the same source (for example, if two tabs are using the deviceâ€™s microphone), the source itself isnâ€™t necessarily immediately stopped. It is instead disassociated from the track and the track object is stopped. Once no media tracks are using the source, the source may actually be completely stopped.</p>
</blockquote>
<blockquote>
<p>Immediately after calling stop(), the track state is set to ended.</p>
</blockquote>
<p>æ‰€ä»¥åœæ­¢å½•éŸ³çš„æ–¹æ³•æ˜¯ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stream.getTracks().forEach(<span class="function"><span class="keyword">function</span>(<span class="params">track</span>) </span>&#123;</span><br><span class="line">  track.stop();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="éŸ³é¢‘æµçš„ä¿å­˜"><a href="#éŸ³é¢‘æµçš„ä¿å­˜" class="headerlink" title="éŸ³é¢‘æµçš„ä¿å­˜"></a>éŸ³é¢‘æµçš„ä¿å­˜</h3><p>å½“æˆ‘ä»¬è°ƒç”¨äº†è®¾å¤‡çš„éº¦å…‹é£ä¹‹åï¼Œå¾—åˆ°äº† <code>stream</code>ã€‚é€šè¿‡ <code>audio</code> æ ‡ç­¾å®ç°äº† <code>stream</code> çš„è¾“å‡ºã€‚æ­¤æ—¶å¦‚æœè¦æŠŠå¾—åˆ°è¿™æ®µ<code>stream</code> ä¿å­˜ä¸‹æ¥è¯¥å¦‚ä½•åšå‘¢ï¼Ÿ</p>
<blockquote>
<p>The MediaStream Recording API, sometimes simply referred to as the Media Recording API or the MediaRecorder API, is closely affiliated with the Media Capture and Streams API and the WebRTC API. The MediaStream Recording API makes it possible to capture the data generated by a MediaStream or HTMLMediaElement object for analysis, processing, or saving to disk. Itâ€™s also surprisingly easy to work with.</p>
</blockquote>
<blockquote>
<p>The MediaStream Recording API is comprised of a single major interface, MediaRecorder, which does all the work of taking the data from a MediaStream and delivering it to you for processing. The data is delivered by a series of dataavailable events, already in the format you specify when creating the MediaRecorder. You can then process the data further or write it to file as desired.</p>
</blockquote>
<p>åŸæ¥è¿˜æœ‰ä¸ª <code>MediaRecorder</code> ç”¨ä»¥å®Œæˆæ•°æ®çš„ä¿å­˜ğŸ˜„</p>
<p>å‚è€ƒ<code>MDN</code> æä¾›çš„demoï¼Œå®ç°éŸ³é¢‘çš„ä¿å­˜å’Œé‡æ’­<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> recordedChunks = []</span><br><span class="line"><span class="keyword">const</span> mediaRecorder = <span class="keyword">new</span> MediaRecorder(stream) <span class="comment">// stream å°±æ˜¯æˆ‘ä»¬å‰é¢è·å–åˆ°çš„ stream</span></span><br><span class="line"></span><br><span class="line">mediaRecorder.ondataavailable = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  recordedChunks.push(e.data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mediaRecorder.onstop = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob(recordedChunks, &#123; <span class="string">'type'</span> : <span class="string">'audio/ogg; codecs=opus'</span> &#125;)</span><br><span class="line">  <span class="keyword">const</span> audio = <span class="built_in">document</span>.querySelector(<span class="string">'audio'</span>) <span class="comment">// æˆ–è€…å…¶ä»–çš„ audio å¯¹è±¡</span></span><br><span class="line">  audio.src = URL.createObjectURL(blob)</span><br><span class="line">  audio.srcObject = <span class="literal">null</span> <span class="comment">// å¦‚æœä¹‹å‰çš„ audioè®¾ç½®äº† srcObject åˆ™éœ€è¦åœ¨æ­¤å¤„è®¾ç½®ä¸ºnullï¼›å¦åˆ™ä¸éœ€è¦æ¬¡æ“ä½œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mediaRecorder.start() <span class="comment">// å¼€å§‹è®°å½•</span></span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  mediaRecorder.stop() <span class="comment">// ç»“æŸè®°å½•</span></span><br><span class="line">&#125;, <span class="number">5000</span>) <span class="comment">// è‡ªå®šä¹‰5såç»“æŸè®°å½•ï¼Œæˆ–è€…æ‰‹åŠ¨ç»“æŸ</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœè¦ä¸‹è½½çš„è¯ï¼Œåªéœ€æŠŠä¸Šé¢åˆ›å»ºçš„ <code>url</code> æ”¾åˆ° <code>a</code> æ ‡ç­¾ä¸­å°±å¯å®ç°ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Media_Streams_API" target="_blank" rel="noopener">Media Capture and Streams API (Media Stream)</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia" target="_blank" rel="noopener">MediaDevices.getUserMedia()</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamTrack/stop" target="_blank" rel="noopener">MediaStreamTrack.stop()</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API" target="_blank" rel="noopener">MediaStream Recording API</a></li>
</ol>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>åŸæ–‡ä½œè€…: </span>
      <a href="https://sampwood.github.io">Sampwood</a>
    </p>
    <p class="copyright-item">
      <span>åŸæ–‡é“¾æ¥: </span>
      <a href="https://sampwood.github.io/2019/10/25/stream-web/">https://sampwood.github.io/2019/10/25/stream-web/</a>
    </p>
    <p class="copyright-item">
      <span>è®¸å¯åè®®: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>
    </p>
  </div>



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/html5/">html5</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2019/11/27/new-quickjs/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">åˆè¯†QuickJS</span>
        <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
      </a>
    
    
      <a class="next" href="/2019/10/09/stylelint/">
        <span class="next-text nav-default">å¼•å…¥stylelintå¯¹é¡¹ç›®åšä»£ç æ ·å¼å®¡æŸ¥</span>
        <span class="prev-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:sampwood@163.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/sampwood" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>



<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://hexo.io/">Hexo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2020

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Sampwood</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
